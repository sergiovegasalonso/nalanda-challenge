<sva-accent-button (click)="addRandomTask()" ariaLabel="Add random task">
  <sva-plus-circle-icon class="mr-2" /> Add Task</sva-accent-button
>
<sva-break-line />
<sva-break-line />
@if (loading()) {
  <sva-loader />
} @else {
  <sva-table>
    <th header>Id</th>
    <th header>Title</th>
    <th header>Description</th>
    <th header>Priority</th>
    <th header>Status</th>
    <th header>Depends On</th>
    <th header>Started At</th>
    <th header>Completed At</th>
    <th header>Blocked Reason</th>
    <th header>Schedule</th>
    <th header>Restart</th>
    <th header>Cancel</th>

    @if (tasks$ | async; as tasks) {
      @for (task of tasks; track task.id) {
        <tr>
          <td class="text-center font-bold" [id]="task.id">{{ task.id }}</td>
          <td>{{ task.title }}</td>
          <td>{{ task.description }}</td>
          <td class="w-36 text-center">
            <sva-badge [badgeColor]="getBadgeColorByPriority(task.priority)">
              {{ getPriorityNameByValue(task.priority) }}
            </sva-badge>
          </td>
          <td class="w-36 text-center">
            <sva-badge [badgeColor]="getBadgeColorByStatus(task.status)">
              {{ getStatusNameByValue(task.status) }}
              @if (task.status === Status.InProgress) {
                <sva-loader [loaderSize]="LoaderSize.ExtraSmall" />
              }
            </sva-badge>
          </td>
          <td>
            {{ getRelatedTaskNames(task.dependsOn) }}
          </td>
          <td>
            {{ task.startAt | date: "MMM dd, yyyy 'at' hh:mm a" }}
          </td>
          <td>
            {{ task.completedAt | date: "MMM dd, yyyy 'at' hh:mm a" }}
          </td>
          <td>{{ task.blockReason }}</td>
          <td class="w-20 text-center">
            <sva-button
              [buttonBehaviour]="
                task.status !== Status.InProgress
                  ? ButtonBehaviour.Active
                  : ButtonBehaviour.Disabled
              "
              ariaLabel="Edit task start at date"
              (click)="startTaskEdition(task)">
              <sva-calendar-days-icon />
            </sva-button>
          </td>
          <td class="w-20 text-center">
            <sva-button
              [buttonBehaviour]="
                task.attempts <= 2 &&
                (task.status === Status.Cancelled ||
                  task.status === Status.Failed)
                  ? ButtonBehaviour.Active
                  : ButtonBehaviour.Disabled
              "
              ariaLabel="Restart task"
              (click)="runTask(task.id)">
              <sva-arrow-path-icon />
            </sva-button>
          </td>
          <td class="w-20 text-center">
            <sva-button
              [buttonBehaviour]="
                task.status === Status.InProgress
                  ? ButtonBehaviour.Active
                  : ButtonBehaviour.Disabled
              "
              ariaLabel="Cancel task"
              (click)="cancelTask(task.id)">
              <sva-x-mark-icon />
            </sva-button>
          </td>
        </tr>
      }
    } @else {
      <tr>
        <td>There are no items.</td>
      </tr>
    }
  </sva-table>
}

<dialog #modal id="modal" class="modal">
  <div class="modal-box">
    <sva-heading-2>{{ taskToEdit()?.title }}</sva-heading-2>
    <sva-break-line />
    <sva-paragraph>Insert startAt date:</sva-paragraph>
    <sva-break-line />
    <sva-break-line />
    <sva-date-input [(ngModel)]="startAtDate" ngDefaultControl />
    <div class="modal-action">
      <form method="dialog" class="flex w-full justify-between">
        <sva-button ariaLabel="Save task edition" (click)="submitTaskEdition()">
          Save
        </sva-button>
        <sva-button
          ariaLabel="Cancel task edition"
          (click)="cancelTaskEdition()">
          Cancel
        </sva-button>
      </form>
    </div>
  </div>
</dialog>
